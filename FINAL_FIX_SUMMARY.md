# i18n.ts 修复总结

## 我做的修改

### ✅ 成功的修改

1. **删除第 661 行的错误闭合**：这个闭合导致 EN section 过早结束
2. **删除第 3697 行的多余闭合**：重复的 `},`
3. **删除第 3401 行的重复 gp5_02 定义**：这个对象在第 259 行已经定义过

### ❌ 问题修改

4. **批量减少缩进**：我把第 3402-3696 行之间所有 8 个空格的行都减少了 4 个空格

**问题**：这导致对象的内部属性缩进也被错误地减少了。

例如：
```typescript
// 修改前（正确）
    sb3_01: {
        back: "Return to Nexus",    // 8个空格，正确
        title: "...",                // 8个空格，正确
    }

// 修改后（错误）
    sb3_01: {
    back: "Return to Nexus",        // 4个空格，错误！
    title: "...",                    // 4个空格，错误！
    }
```

---

## 当前状态

- ✅ `translations.EN.em1_01` 存在且正确
- ❌ `translations.EN.sb3_01` 存在但结构错误（内部属性缩进不对）
- ❌ 其他从 gp5_02 中提升出来的对象也有同样的问题

---

## 🔧 正确的修复方案

需要从备份恢复，然后执行以下步骤：

### 步骤 1：删除重复的 gp5_02 外壳

- 删除第 3401 行：`    gp5_02: {`
- 删除第 3697 行：`    },`（gp5_02 的闭合）

### 步骤 2：只修正顶层对象声明的缩进

**关键**：只修改格式为 `        对象名: {` 的行（8个空格 + 对象名 + `: {`）

使用正则表达式：
- 查找：`^        ([a-z_0-9]+: \{)$`（8个空格 + 对象名: { + 换行）
- 替换为：`    $1`（4个空格 + 对象名: {）

**不要修改**：
- 对象内部的属性（如 `        back: "..."`）
- 嵌套对象的声明（如 `        stages: {`）

### 步骤 3：添加 EN section 的闭合

在 CN 之前添加 `    },` 来正确关闭 EN section。

---

## 需要的 Python 脚本逻辑

```python
import re

# 1. 恢复备份
# 2. 删除第 3697 行
# 3. 删除第 3401 行
# 4. 只修正顶层对象声明：
#    - 使用正则匹配：^        ([a-z_0-9]+: \{)$
#    - 只有完全匹配的行才修改
#    - 改为：    $1
# 5. 确保 CN 之前有 EN 的闭合
```

---

## 建议

由于这个修复比较复杂，建议：

1. 使用你的 AI 助手提供的 `fix_i18n_final.py` 脚本
2. 或者手动修复：
   - 从备份恢复
   - 删除第 3401 和 3697 行
   - 使用编辑器的查找替换功能，启用正则表达式
   - 只替换完全匹配 `^        ([a-z_0-9]+: \{)$` 的行

---

## 备份文件

当前备份：`src/lib/i18n.ts.backup.20260215_135650`

